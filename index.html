<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Soul Fruit Control Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="page">
    <header class="page-header">
      <h1>Soul Fruit Control Panel</h1>
      <p>
        Track harvested souls, spend Soul Power Units (SPU) to create and upgrade homies, shape soul-infused domains,
        and generate abilities for your One Piece–style Big Mom soul fruit.
      </p>
    </header>

    <!-- PANEL 1: HARVEST A SOUL -->
    <section class="card card-collapsible" data-panel="1">
      <div class="card-header">
        <h2>1. Harvest a Soul</h2>
        <button class="collapse-toggle" type="button">▼</button>
      </div>
      <div class="card-body">
        <div class="grid-2">
          <div class="field">
            <label for="soul-name">Target Name / Title</label>
            <input id="soul-name" type="text" placeholder="Panicked Vice Admiral, Dragon, Bandit #3" />
          </div>

          <div class="field">
            <label for="soul-raw">Raw Might Rating (0–20)</label>
            <input id="soul-raw" type="number" min="0" max="20" value="5" />
            <small>Overall strength impression in One Piece terms.</small>
          </div>

          <div class="field">
            <label for="soul-template">Template Tier</label>
            <select id="soul-template">
              <!-- filled by JS -->
            </select>
            <small>Peasant → elite fighter → boss → mythical / divine threat.</small>
          </div>

          <div class="field">
            <label for="soul-traits">Traits / Flavor Tags (optional)</label>
            <input id="soul-traits" type="text" placeholder="brave, cruel, beast, storm, gluttonous" />
            <small>Used later to flavor homie personalities and domains.</small>
          </div>
        </div>

        <hr class="section-separator" />

        <h3 class="subheading">Fear Check & Terror Roll Helper</h3>
        <p class="helper-text">
          When you attempt a Soul Rip, the target makes a Fear/Wisdom save against your Soul DC. If they fail,
          you roll a Terror Roll to see how much of their soul you rip out.
        </p>

        <div class="grid-3">
          <div class="field">
            <label for="soul-dc">Soul DC Used</label>
            <input id="soul-dc" type="number" min="1" value="17" />
            <small>From your Soul DC helper or spell save DC.</small>
          </div>

          <div class="field">
            <label for="soul-save-roll">Target's Save Result</label>
            <input id="soul-save-roll" type="number" min="1" value="12" />
            <small>Include all their bonuses and the d20 result.</small>
          </div>

          <div class="field">
            <label for="soul-failure-margin">Failure Margin (auto)</label>
            <input id="soul-failure-margin" type="number" readonly />
            <small>Calculated as Soul DC − Save Result (min 0).</small>
          </div>
        </div>

        <div class="grid-3">
          <div class="field">
            <label for="soul-d20-roll">Terror d20 Roll</label>
            <input id="soul-d20-roll" type="number" min="1" max="20" value="10" />
            <small>d20 rolled after they fail the fear save.</small>
          </div>

          <div class="field">
            <label for="soul-terror-roll">Total Terror Roll (auto)</label>
            <input id="soul-terror-roll" type="number" readonly />
            <small>d20 + Failure Margin.</small>
          </div>

          <div class="field">
            <label for="soul-maxhp-lost">Max HP Lost (suggested)</label>
            <input id="soul-maxhp-lost" type="number" readonly />
            <small>For notes only; DM can adjust.</small>
          </div>
        </div>

        <div class="actions-row">
          <button id="btn-calc-soul" type="button" class="btn-primary">Calculate Soul Level & SPU</button>
          <button id="btn-add-soul" type="button" class="btn-secondary">Add to Soul Bank</button>
        </div>

        <div id="soul-calc-output" class="calc-output"></div>
      </div>
    </section>

    <!-- PANEL 2: SOUL BANK -->
    <section class="card card-collapsible" data-panel="2">
      <div class="card-header">
        <h2>2. Soul Bank & Captured Spirits</h2>
        <button class="collapse-toggle" type="button">▼</button>
      </div>
      <div class="card-body">
        <div class="totals-row">
          <span>Total Soul Power (SPU): <strong id="total-spu">0</strong></span>
          <span>SPU Invested in Homies / Domains: <strong id="spent-spu">0</strong></span>
          <span>Available SPU: <strong id="available-spu">0</strong></span>
        </div>
        <div id="soul-list" class="soul-list">
          <!-- soul cards injected here -->
        </div>
      </div>
    </section>

    <!-- PANEL 3: HOMIE WORKSHOP -->
    <section class="card card-collapsible" data-panel="3">
      <div class="card-header">
        <h2>3. Homie Workshop & Upgrades</h2>
        <button class="collapse-toggle" type="button">▼</button>
      </div>
      <div class="card-body">
        <p class="helper-text">
          Spend SPU from the Soul Bank to create and upgrade homies. When a homie is destroyed, you can pay a revival
          cost based on how much SPU you invested in them.
        </p>

        <div class="homie-toolbar">
          <div class="field homie-filter-field">
            <label for="homie-type-filter">Show Homies of Type</label>
            <select id="homie-type-filter">
              <option value="all">All Types</option>
              <option value="minor">Minor Homies</option>
              <option value="territory">Territory Homies</option>
              <option value="buff">Buff Homies</option>
              <option value="signature">Signature Homies</option>
            </select>
          </div>

          <div class="homie-create-buttons">
            <button id="btn-add-minor-homie" type="button" class="btn-secondary">+ Minor Homie</button>
            <button id="btn-add-territory-homie" type="button" class="btn-secondary">+ Territory Homie</button>
            <button id="btn-add-buff-homie" type="button" class="btn-secondary">+ Buff Homie</button>
            <button id="btn-add-signature-homie" type="button" class="btn-secondary">+ Signature Homie</button>
          </div>
        </div>

        <div id="homie-list" class="homie-card-grid">
          <!-- homie cards injected here -->
        </div>
      </div>
    </section>

    <!-- PANEL 4: DOMAINS & TERRITORY HOMIES -->
    <section class="card card-collapsible" data-panel="4">
      <div class="card-header">
        <h2>4. Domains & Territory Homies</h2>
        <button class="collapse-toggle" type="button">▼</button>
      </div>
      <div class="card-body">
        <p class="helper-text">
          Shape Totto Land–style domains: castles, forests, ships, and cities where the very roads, buildings,
          and terrain are homies that obey you.
        </p>

        <div class="grid-2">
          <div class="field">
            <label for="domain-name">Domain Name</label>
            <input id="domain-name" type="text" placeholder="Candy Castle, Forest of Screams, Soul-Paved City" />
          </div>
          <div class="field">
            <label for="domain-tier">Domain Tier (1–10)</label>
            <input id="domain-tier" type="number" min="1" max="10" value="5" />
            <small>Bigger, more complex domains have stronger lair actions.</small>
          </div>
        </div>

        <div class="field">
          <label for="domain-homie-select">Territory Homies Assigned to This Domain</label>
          <select id="domain-homie-select" multiple></select>
          <small>Select any homies of type "Territory" to bind them to this domain.</small>
        </div>

        <div class="actions-row">
          <button id="btn-generate-domain" type="button" class="btn-primary">Generate / Update Domain Card</button>
          <button id="btn-edit-homies-domain" type="button" class="btn-secondary">
            Edit Homies for This Domain
          </button>
        </div>

        <div id="domain-card" class="domain-card-container">
          <!-- generated domain card -->
        </div>
      </div>
    </section>

    <!-- PANEL 5: ASK THE SOULS (AI) -->
    <section class="card card-collapsible" data-panel="5">
      <div class="card-header">
        <h2>5. Ask the Souls (AI Homie & Ability Generator)</h2>
        <button class="collapse-toggle" type="button">▼</button>
      </div>
      <div class="card-body">
        <div class="field">
          <label for="ai-notes">Extra Notes / Theme</label>
          <textarea
            id="ai-notes"
            rows="3"
            placeholder="Examples: healing cake nurse homies, storm homie that guards the castle, weapon homie that stores souls."
          ></textarea>
          <small>
            The AI will see your soul bank, homies, and domains, then propose abilities and forms that fit your current
            power level.
          </small>
        </div>

        <div class="actions-row">
          <button id="btn-generate-abilities" type="button" class="btn-primary">
            Generate Homie Abilities with AI
          </button>
          <button id="btn-add-empty-ability" type="button" class="btn-secondary">
            Add Empty Ability Card
          </button>
        </div>

        <div id="ability-cards-container" class="ability-card-grid">
          <!-- ability cards injected here -->
        </div>
      </div>
    </section>

    <!-- PANEL 6: SOUL PARTY DASHBOARD -->
    <section class="card card-collapsible" data-panel="6">
      <div class="card-header">
        <h2>6. Soul Party Dashboard</h2>
        <button class="collapse-toggle" type="button">▼</button>
      </div>
      <div class="card-body">
        <p>
          At-a-glance views for you (Soul Fruit user), each ally, each homie, and each domain. Use this section as a
          quick reference at the table or print it as a handout.
        </p>
        <div id="summary-grid" class="summary-grid">
          <!-- summary cards injected here -->
        </div>

        <div class="summary-actions">
          <button id="btn-save-now" type="button" class="btn-secondary">Save Now</button>
          <button id="btn-print" type="button" class="btn-secondary">Print Quick Reference</button>
          <button id="btn-reset" type="button" class="btn-danger">Reset All Data</button>
        </div>
        <p class="small-note">All data is automatically saved in your browser using localStorage.</p>
      </div>
    </section>
  </div>

  <script src="script.js" defer></script>
</body>
</html>
